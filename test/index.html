<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>拾光旅圖</title>
	<link rel="icon" type="image/svg+xml" href="travel-bag-svgrepo-com.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-slate-50 pb-24 text-slate-800 font-sans">
    <div id="app" v-cloak>
        <div v-if="loading" class="loading-overlay">
            <div class="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
            <p class="mt-4 text-sm font-bold text-blue-600 tracking-widest">同步數據中...</p>
        </div>

<div v-if="lightboxUrl" class="fixed inset-0 z-[100] bg-black/95 flex items-center justify-center backdrop-blur-md" @click.self="lightboxUrl = null">
    <button @click="lightboxUrl = null" class="absolute top-6 right-6 w-12 h-12 flex items-center justify-center bg-white/10 text-white rounded-full text-2xl z-[110]">
        <i class="fa-solid fa-xmark"></i>
    </button>
    
    <img :src="lightboxUrl" 
         class="max-w-full max-h-full object-contain shadow-2xl"
         :style="zoomStyle"
         @touchstart.stop="handleTouchStartImg"
         @touchmove.stop="handleTouchMoveImg"
         @touchend.stop="handleTouchEndImg">

    <button v-if="lightboxIndex > 0 && zoomScale <= 1.1" @click.stop="prevPhoto" class="absolute left-4 text-white/50 text-3xl p-4"><i class="fa-solid fa-chevron-left"></i></button>
    <button v-if="lightboxIndex < lightboxUrls.length - 1 && zoomScale <= 1.1" @click.stop="nextPhoto" class="absolute right-4 text-white/50 text-3xl p-4"><i class="fa-solid fa-chevron-right"></i></button>
</div>

        <header v-if="['itinerary', 'wish'].includes(currentTab)" class="sticky top-0 z-40 bg-white/80 backdrop-blur-md shadow-sm">
            <div v-if="currentTab === 'itinerary'" class="flex overflow-x-auto px-4 py-4 gap-3 no-scrollbar border-b">
                <div @click="filterDate = ''" :class="{'date-card active': filterDate === ''}" class="date-card flex-none bg-white border px-4 py-2 rounded-xl text-center shadow-sm min-w-[65px] cursor-pointer italic font-bold text-sm text-slate-400">全部</div>
                <div v-for="d in availableDates" :key="d" @click="filterDate = d" :class="{'date-card active': filterDate === d}" class="date-card flex-none bg-white border px-3 py-2 rounded-xl text-center shadow-sm min-w-[85px] cursor-pointer transition-all">
                    <div class="text-[10px] opacity-60 font-bold uppercase">{{ getWeekday(d) }}</div>
                    <div class="font-bold text-sm">{{ formatDisplayDate(d) }}</div>
                </div>
            </div>

            <div v-if="currentTab === 'wish'" class="space-y-3 py-4 border-b">
                <div class="flex overflow-x-auto px-4 gap-2 no-scrollbar">
                    <div v-for="tag in travelersAndCats.tags" :key="tag" @click="toggleTagFilter(tag)" :class="{'tag-filter active': selectedWishTags.includes(tag), 'bg-white text-slate-400 border': !selectedWishTags.includes(tag)}" class="flex-none px-4 py-1.5 rounded-full border text-xs font-bold cursor-pointer transition-all shadow-sm">#{{ tag }}</div>
                </div>
                <div class="px-4">
                    <div class="relative">
                        <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-slate-300 text-xs"></i>
                        <input v-model="wishSearchQuery" type="text" placeholder="搜尋願望內容或標籤..." class="w-full bg-slate-100 border-none rounded-2xl py-2.5 pl-10 pr-4 text-sm outline-none focus:ring-2 ring-blue-500/20 transition-all">
                        <button v-if="wishSearchQuery" @click="wishSearchQuery = ''" class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-300"><i class="fa-solid fa-circle-xmark"></i></button>
                    </div>
                </div>
            </div>
        </header>

        <main class="max-w-xl mx-auto p-4">
            <div v-if="currentTab === 'itinerary'" class="space-y-4">
                <div v-for="item in filteredItinerary" :key="item.id + item.day" @click="toggleExpand('itinerary_' + item.id)" :class="['itinerary-item p-4 rounded-2xl shadow-sm relative transition-all duration-300 cursor-pointer mb-4', `category-${item.category}`]">
                    <div class="flex items-start gap-4">
                        <div class="flex flex-col items-center min-w-[55px]">
                            <div class="time-text font-bold text-lg font-mono leading-none">{{ formatDisplayTime(item.time) }}</div>
                            <div v-if="!filterDate" class="mt-2 text-[10px] text-slate-400 font-bold border px-1.5 rounded-md bg-white">{{ formatDisplayDate(item.day) }}</div>
                        </div>

                        <div class="flex-1 min-w-0">
                            <span :class="['tag-badge', `badge-${item.category}`]">{{ item.category }}</span>
                            <h3 class="font-bold text-slate-800 mt-1 leading-snug break-words">{{ item.content }}</h3>
                            
                            <div v-if="item.image && parseImages(item.image).length > 0" class="mt-3 flex gap-2 overflow-x-auto no-scrollbar">
                                <img v-for="(img, idx) in parseImages(item.image)" :key="idx" :src="img" @click.stop="openLightbox(parseImages(item.image), idx)" class="w-24 h-24 object-cover rounded-xl shadow-sm flex-none cursor-pointer">
                            </div>

                            <div v-if="item.location" @click.stop="openGoogleMaps(item.location)" class="location-tag inline-flex items-center gap-1.5 text-xs px-2 py-1.5 rounded-lg mt-3 cursor-pointer transition-colors">
                                <i class="fa-solid fa-location-dot"></i> <span class="truncate max-w-[180px] font-medium">{{ item.location }}</span>
                            </div>

                            <div v-if="item.remark" class="mt-3">
                                <div :class="['content-text text-xs text-slate-600 leading-relaxed bg-slate-100/50 p-3 rounded-xl', {'line-clamp-3': !expandedItems.includes('itinerary_' + item.id)}]" v-html="linkify(item.remark)"></div>
                            </div>
                        </div>
                    </div>

                    <div class="absolute top-2 right-2 flex" :class="{'opacity-100': expandedItems.includes('itinerary_' + item.id), 'opacity-0': !expandedItems.includes('itinerary_' + item.id)}">
                        <button @click.stop="openEditModal(item)" class="p-2 text-slate-300 hover:text-blue-500 transition-colors"><i class="fa-solid fa-pen text-xs"></i></button>
                        <button @click.stop="deleteItem('Itinerary', item.id)" class="p-2 text-slate-300 hover:text-red-500 transition-colors"><i class="fa-solid fa-trash text-xs"></i></button>
                    </div>
                </div>
            </div>

<div v-if="currentTab === 'expense'" class="space-y-4">
    <div class="expense-summary-card p-6 rounded-[2.5rem] shadow-xl">
        
        <div v-if="travelersAndCats.travelers.length > 1" class="grid grid-cols-2 gap-3 mb-6">
            <div>
                <label class="text-[10px] opacity-40 block mb-1 font-bold uppercase tracking-wider">付款人</label>
                <select v-model="debtFilter.payer" class="expense-filter-select w-full rounded-xl p-2 text-xs">
                    <option value="all" class="text-slate-800">全部付款人</option>
                    <option v-for="t in travelersAndCats.travelers" :value="t" class="text-slate-800">{{t}}</option>
                </select>
            </div>
            <div>
                <label class="text-[10px] opacity-40 block mb-1 font-bold uppercase tracking-wider">應付人</label>
                <select v-model="debtFilter.debtor" class="expense-filter-select w-full rounded-xl p-2 text-xs">
                    <option value="all" class="text-slate-800">全部應付人</option>
                    <option v-for="t in travelersAndCats.travelers" :value="t" class="text-slate-800">{{t}}</option>
                </select>
            </div>
        </div>

        <div class="total-amount-box flex justify-between items-end">
            <div>
                <div class="text-[10px] opacity-50 mb-1 font-bold uppercase tracking-widest">篩選總計 (TWD)</div>
                <div class="total-amount-value text-3xl font-mono tracking-tighter">
                    {{ filteredTotalTWD }}
                </div>
            </div>
            <div class="filter-status-tag text-[10px] px-2 py-1 rounded-lg mb-1" 
                 v-if="debtFilter.payer !== 'all' || debtFilter.debtor !== 'all'">
                已套用篩選
            </div>
        </div>

        <div class="summary-grid mt-6 pt-6 border-t border-white/10">
            <div v-for="(amount, curr) in sortedExpensesByFilter.reduce((acc, cur) => { acc[cur.currency] = (acc[cur.currency] || 0) + Number(cur.amount); return acc; }, {})" 
                 class="summary-item">
                <div class="summary-label opacity-70">{{ curr }}</div>
                <div class="summary-amount font-mono">{{ amount.toLocaleString() }}</div>
            </div>
        </div>
    </div>

                <div class="table-container no-scrollbar">
                    <table>
                        <thead>
                            <tr>
                                <th>日期</th>
                                <th>項目 / 方式</th>
                                <th>金額</th>
                                <th v-if="travelersAndCats.travelers.length > 1">分攤</th>
                                <th class="text-center">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="exp in sortedExpensesByFilter" :key="exp.id">
                                <td class="text-slate-400 font-mono text-[10px]">{{ formatDisplayDate(exp.date) }}</td>
                                <td>
                                    <div class="flex items-center gap-1">
                                        <span class="font-bold text-slate-700 truncate max-w-[100px]">{{ exp.item }}</span>
                                        <button v-if="exp.image && parseImages(exp.image).length > 0" @click="openLightbox(parseImages(exp.image), 0)" class="text-blue-500"><i class="fa-solid fa-camera text-[10px]"></i></button>
                                    </div>
                                    <div class="flex gap-1 items-center mt-0.5"><span class="text-[9px] bg-slate-100 text-slate-500 px-1 rounded border scale-90 origin-left">{{ exp.paymentMethod }}</span></div>
                                    <div v-if="exp.remark" class="content-text text-[11px] text-slate-400 mt-1 leading-tight border-l-2 border-slate-100 pl-2">{{ exp.remark }}</div>
                                </td>
                                <td>
                                    <div class="font-bold font-mono text-blue-600 text-xs">{{ exp.amount }} {{ exp.currency }}</div>
                                    <div class="text-[9px] text-slate-400">≈ NT${{ exp.twd }}</div>
                                </td>
                                <td v-if="travelersAndCats.travelers.length > 1">
                                    <div class="text-[10px]"><span class="text-blue-500 font-bold">{{ exp.payer }}</span> 付</div>
                                    <div class="text-[9px] text-slate-400 truncate max-w-[60px]">→ {{ exp.debtor }}</div>
                                </td>
                                <td>
                                    <div class="flex gap-1.5 justify-center">
                                        <button @click="openEditModal(exp)" class="w-7 h-7 bg-slate-50 text-slate-300 hover:text-blue-500 rounded-full flex items-center justify-center transition-colors"><i class="fa-solid fa-pen text-[10px]"></i></button>
                                        <button @click="deleteItem('Expenses', exp.id)" class="w-7 h-7 bg-red-50/50 text-red-200 hover:text-red-500 rounded-full flex items-center justify-center transition-colors"><i class="fa-solid fa-trash text-[10px]"></i></button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

<div v-if="currentTab === 'wish'" class="grid grid-cols-1 gap-4">
    <div v-for="wish in filteredWishes" :key="wish.id" @click="toggleExpand('wish_' + wish.id)" 
         :class="['wish-card transition-all duration-300 p-4 rounded-3xl bg-white border border-slate-100 shadow-sm', {'item-done': isWishDone(wish)}]">
        
        <div class="flex gap-4">
            <button @click.stop="toggleWishDone(wish)" 
                    :class="['wish-checker text-2xl transition-colors shrink-0', isWishDone(wish) ? 'text-emerald-500' : 'text-slate-200 hover:text-blue-400']">
                <i :class="['fa-solid', isWishDone(wish) ? 'fa-circle-check' : 'fa-circle']"></i>
            </button>

            <div class="flex-1 min-w-0">
                <div class="flex flex-wrap gap-1.5 mb-2">
                    <span v-for="t in (wish.tag||'').split(',').filter(x=>x)" 
                          class="text-[9px] bg-blue-50 text-blue-500 px-2 py-0.5 rounded-full font-bold border border-blue-100">#{{ t }}</span>
                </div>

                <div v-if="!expandedItems.includes('wish_' + wish.id) || !hasTodos(wish.content)" 
                     :class="['content-text font-bold text-slate-800 leading-relaxed mb-3 transition-all', {'line-clamp-3': !expandedItems.includes('wish_' + wish.id)}]" 
                     v-html="linkify(wish.content)">
                </div>

                <div v-else class="space-y-2 mb-4">
                    <div v-for="(todo, index) in parseTodos(wish.content)" :key="index" 
                         @click.stop="toggleSubTodo(wish, index)"
                         class="flex items-start gap-3 p-3 bg-slate-50/50 rounded-2xl hover:bg-slate-100 transition-all cursor-pointer border border-transparent hover:border-slate-200">
                        <i :class="['fa-solid mt-0.5 shrink-0', todo.done ? 'fa-square-check text-blue-500' : 'fa-square text-slate-300']"></i>
                        <span :class="['text-sm font-bold text-slate-700', {'line-through text-slate-400 opacity-60': todo.done}]">
                            {{ todo.text }}
                        </span>
                    </div>
                </div>

                <div v-if="parseImages(wish.image).length > 0" class="flex gap-2 overflow-x-auto no-scrollbar mb-3">
                    <img v-for="(img, idx) in parseImages(wish.image)" :src="img" 
                         @click.stop="openLightbox(parseImages(wish.image), idx)" 
                         class="w-20 h-20 object-cover rounded-xl shadow-sm border border-slate-100 shrink-0">
                </div>

                <div class="flex justify-between items-center pt-3 border-t border-slate-50">
                    <span class="text-[9px] text-slate-400 font-black uppercase tracking-tighter">BY {{ wish.payer }}</span>
                    
                    <div class="flex gap-2 transition-opacity duration-300" 
                         :class="expandedItems.includes('wish_' + wish.id) ? 'opacity-100' : 'opacity-0 pointer-events-none'">
                        <button @click.stop="openEditModal(wish)" class="p-2 text-slate-300 hover:text-blue-500 transition-colors">
                            <i class="fa-solid fa-pen text-[11px]"></i>
                        </button>
                        <button @click.stop="deleteItem('Wishes', wish.id)" class="p-2 text-slate-300 hover:text-red-500 transition-colors">
                            <i class="fa-solid fa-trash text-[11px]"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

            <div v-if="currentTab === 'setting'" class="space-y-6">
                <div class="bg-white p-6 rounded-[2.5rem] shadow-sm space-y-5 border border-slate-100">
                    <div v-for="(val, key) in {travelers:'旅行夥伴 (半角逗號隔開)', categories:'行程分類', wishTags:'許願標籤', paymentMethods:'付款方式'}" :key="key">
                        <label class="field-label flex items-center gap-2 mb-2 font-bold text-xs"><i class="fa-solid fa-tag text-blue-500 text-[10px]"></i>{{ val }}</label>
                        <input v-model="settingForm[key]" class="w-full border-b border-slate-100 py-2 outline-none text-sm focus:border-blue-500 bg-transparent font-medium">
                    </div>
                    <div class="pt-2">
                        <label class="field-label flex items-center gap-2 mb-4 font-bold text-xs"><i class="fa-solid fa-coins text-amber-500 text-[10px]"></i>匯率與幣別設定</label>
                        <div v-for="(r, idx) in localRates" :key="idx" class="flex gap-2 mb-3 items-center bg-slate-50 p-2 rounded-2xl">
                            <input v-model="r.code" placeholder="幣別" class="w-16 border-none rounded-xl p-2 text-sm uppercase bg-white shadow-sm text-center font-bold flex-shrink-0">
                            <input v-model.number="r.rate" step="0.001" type="number" class="flex-1 min-w-0 border-none rounded-xl p-2 text-sm bg-white shadow-sm font-mono">
                            <button @click="localRates.splice(idx,1)" class="text-red-300 p-2 flex-shrink-0"><i class="fa-solid fa-circle-minus"></i></button>
                        </div>
                        <button @click="localRates.push({code:'', rate:1})" class="w-full border-2 border-dashed border-slate-100 text-slate-400 text-[10px] font-bold py-3 rounded-2xl transition-colors hover:bg-slate-50">+ 新增幣別</button>
                    </div>
                    <button @click="saveSettings" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold shadow-lg shadow-blue-500/30 active:scale-95 transition-all">儲存所有設定</button>
                </div>
            </div>
        </main>

        <div v-if="showModal" class="fixed inset-0 z-50 flex items-end sm:items-center justify-center p-4">
            <div @click="showModal = false" class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm"></div>
            <div class="relative bg-white w-full max-w-md rounded-t-[2.5rem] sm:rounded-[2.5rem] p-8 shadow-2xl overflow-y-auto max-h-[92vh] no-scrollbar animate-slide-up">
                <div class="w-12 h-1.5 bg-slate-100 rounded-full mx-auto mb-8 sm:hidden"></div>
                <h2 class="text-xl font-black mb-8 text-slate-800 tracking-tight">{{ isEditing ? '編輯' : '新增' }}{{ tabNames[currentTab] }}</h2>
                
                <form @submit.prevent="submitForm" class="space-y-6 pb-6">
                    <div class="p-5 bg-slate-50 rounded-3xl border border-slate-100 shadow-inner">
                        <label class="field-label flex justify-between mb-4 font-bold text-xs">
                            <span class="text-slate-700">相片管理</span>
                            <span class="text-[10px] text-blue-500 font-bold bg-white px-2 py-0.5 rounded-full shadow-sm">{{ currentTab === 'expense' ? '限 1 張' : '最多 5 張' }}</span>
                        </label>
                        <div class="flex flex-wrap gap-3">
                            <template v-if="!uploading">
                                <div v-for="(img, idx) in (Array.isArray(form.image) ? form.image : (form.image ? [form.image] : []))" :key="idx" v-show="img && img.startsWith('http')" class="relative bg-emerald-100 text-emerald-700 px-3 py-2 rounded-xl flex items-center gap-2 border border-emerald-200 shadow-sm">
                                    <i class="fa-solid fa-check-circle text-xs"></i>
                                    <span class="text-[10px] font-bold">已上傳</span>
                                    <button type="button" @click="removeImage(idx)" class="ml-1 text-emerald-900/40 hover:text-red-500"><i class="fa-solid fa-circle-xmark"></i></button>
                                </div>
                            </template>
                            <div v-if="uploading" class="w-full py-4 flex flex-col items-center justify-center bg-blue-50 rounded-2xl border-2 border-dashed border-blue-200 text-blue-500">
                                <i class="fa-solid fa-circle-notch fa-spin text-sm"></i>
                                <span class="text-[10px] mt-2 font-black tracking-widest">UPLOAD: {{ uploadProgress.current }}/{{ uploadProgress.total }}</span>
                            </div>
                            <label v-else class="w-full sm:w-24 h-12 flex flex-row items-center justify-center gap-2 bg-white rounded-xl border-2 border-slate-100 shadow-sm cursor-pointer hover:bg-slate-50 transition-all">
                                <i class="fa-solid fa-plus text-slate-300 text-xs"></i>
                                <span class="text-[10px] text-slate-400 font-bold">新增相片</span>
                                <input type="file" class="hidden" accept="image/*" @change="compressAndUpload" :multiple="currentTab !== 'expense'">
                            </label>
                        </div>
                    </div>

                    <template v-if="currentTab === 'itinerary'">
                        <div class="flex flex-col sm:grid sm:grid-cols-2 gap-4">
                            <div><label class="field-label font-bold text-xs block mb-1">日期</label><input v-model="form.day" type="date" class="bg-slate-50 p-3.5 rounded-2xl w-full text-sm outline-none" required></div>
                            <div><label class="field-label font-bold text-xs block mb-1">時間</label><input v-model="form.time" type="text" class="bg-slate-50 p-3.5 rounded-2xl w-full text-sm font-mono outline-none text-center" placeholder="HHmm" required></div>
                        </div>
                        <div><label class="field-label font-bold text-xs block mb-1">內容</label><input v-model="form.content" class="bg-slate-50 p-3.5 rounded-2xl w-full text-sm outline-none font-bold" required></div>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="field-label font-bold text-xs block mb-1">分類</label><select v-model="form.category" class="bg-slate-50 p-3.5 rounded-2xl w-full text-sm outline-none font-bold"><option v-for="c in travelersAndCats.cats" :value="c">{{c}}</option></select></div>
                            <div v-if="form.category==='飯店'"><label class="field-label font-bold text-xs block mb-1">晚數</label><input v-model.number="form.duration" type="number" class="bg-slate-50 p-3.5 rounded-2xl w-full text-sm outline-none"></div>
                        </div>
                        <div><label class="field-label font-bold text-xs block mb-1">地點</label><input v-model="form.location" class="bg-slate-50 p-3.5 rounded-2xl w-full text-sm outline-none" placeholder="景點名稱或地址"></div>
                        <div><label class="field-label font-bold text-xs block mb-1">備註</label><textarea v-model="form.remark" class="bg-slate-50 p-3.5 rounded-2xl w-full h-24 text-sm outline-none"></textarea></div>
                    </template>

                    <template v-if="currentTab === 'expense'">
                        <div class="flex flex-col sm:grid sm:grid-cols-2 gap-4">
                            <div><label class="field-label font-bold text-xs block mb-1">日期</label><input v-model="form.date" type="date" class="bg-slate-50 p-3.5 rounded-2xl w-full text-sm outline-none" required></div>
                            <div><label class="field-label font-bold text-xs block mb-1">幣別</label><select v-model="form.currency" class="bg-slate-50 p-3.5 rounded-2xl w-full text-sm outline-none font-bold"><option v-for="r in localRates" :value="r.code">{{ r.code }}</option></select></div>
                        </div>
                        <div><label class="field-label font-bold text-xs block mb-1">品名</label><input v-model="form.item" class="bg-slate-50 p-3.5 rounded-2xl w-full text-sm outline-none font-bold" required></div>
                        <div><label class="field-label font-bold text-xs block mb-1">金額</label><input v-model.number="form.amount" type="number" step="any" class="bg-slate-50 p-3.5 rounded-2xl w-full text-lg font-mono outline-none text-blue-600 font-black" required></div>
                        <div class="p-5 bg-slate-50 rounded-[2rem] space-y-5 border border-slate-100">
                            <div>
                                <p class="field-label mb-3 font-bold text-xs">支付方式</p>
                                <div class="flex flex-wrap gap-2"><span v-for="m in travelersAndCats.paymentMethods" @click="form.paymentMethod=m" :class="form.paymentMethod===m?'bg-emerald-500 text-white border-emerald-500':'bg-white border-slate-100 text-slate-400'" class="px-4 py-2 rounded-xl text-xs font-bold cursor-pointer transition-all border shadow-sm">{{m}}</span></div>
                            </div>
                            <div v-if="travelersAndCats.travelers.length > 1">
                                <p class="field-label mb-3 font-bold text-xs">代墊人員</p>
                                <div class="flex flex-wrap gap-2"><span v-for="t in travelersAndCats.travelers" @click="handlePayerSelect(t)" :class="form.payer===t?'bg-blue-600 text-white border-blue-600':'bg-white border-slate-100 text-slate-400'" class="px-4 py-2 rounded-xl text-xs font-bold cursor-pointer transition-all border shadow-sm">{{t}}</span></div>
                            </div>
                            <div v-if="travelersAndCats.travelers.length > 1">
                                <p class="field-label mb-3 font-bold text-xs">分攤人員</p>
                                <div class="flex flex-wrap gap-2"><span v-for="t in travelersAndCats.travelers" @click="toggleSelection(t, 'debtor')" :class="isItemSelected(t, 'debtor')?'bg-amber-500 text-white border-amber-500':'bg-white border-slate-100 text-slate-400'" class="px-4 py-2 rounded-xl text-xs font-bold cursor-pointer transition-all border shadow-sm">{{t}}</span></div>
                            </div>
                        </div>
                    </template>

<template v-if="currentTab === 'wish'">
    <div>
        <div class="flex justify-between items-center mb-2 px-1">
            <label class="field-label font-bold text-xs block text-slate-500">想要什麼？</label>
            <button type="button" @click="insertTodoTag" 
                    class="text-[10px] bg-blue-50 text-blue-600 px-3 py-1.5 rounded-full font-bold hover:bg-blue-100 transition-all active:scale-95 shadow-sm border border-blue-100">
                <i class="fa-solid fa-list-check mr-1"></i> 插入待辦格式
            </button>
        </div>
        
        <textarea v-model="form.content" id="wishContent" @keydown="handleWishKeydown" 
                  class="bg-slate-50 p-4 rounded-3xl w-full h-40 text-sm outline-none font-bold border border-transparent focus:border-blue-100 transition-all" 
                  placeholder="想要吃什麼、買什麼...按 Enter 可自動生成下一行清單" required></textarea>
        <p class="text-[10px] text-slate-400 mt-2 ml-2">提示：清單開頭為 - [ ] 代表待辦事項</p>
    </div>

    <div class="p-5 bg-slate-50 rounded-[2rem] space-y-5 border border-slate-100">
        <div>
            <p class="field-label mb-3 font-bold text-xs text-slate-500">標籤選擇</p>
            <div class="flex flex-wrap gap-2">
                <span v-for="tag in travelersAndCats.tags" @click="toggleSelection(tag, 'tag')" 
                      :class="isItemSelected(tag, 'tag')?'bg-blue-600 text-white border-blue-600':'bg-white border-slate-100 text-slate-400'" 
                      class="px-4 py-2 rounded-xl text-xs font-bold cursor-pointer transition-all border shadow-sm">
                    #{{tag}}
                </span>
            </div>
        </div>
        <div>
            <p class="field-label mb-3 font-bold text-xs text-slate-500">許願人</p>
            <div class="flex flex-wrap gap-2">
                <span v-for="t in travelersAndCats.travelers" @click="form.payer=t" 
                      :class="form.payer===t?'bg-blue-600 text-white border-blue-600':'bg-white border-slate-100 text-slate-400'" 
                      class="px-4 py-2 rounded-xl text-xs font-bold cursor-pointer transition-all border shadow-sm">
                    {{t}}
                </span>
            </div>
        </div>
    </div>
</template>
                    
                    <button type="submit" :disabled="uploading" :class="uploading ? 'bg-slate-300' : 'bg-blue-600 active:scale-95 shadow-blue-500/40'" class="w-full text-white py-5 rounded-3xl font-black mt-4 shadow-xl flex items-center justify-center gap-3 transition-all">
                        <i v-if="uploading" class="fa-solid fa-spinner fa-spin"></i>
                        <span class="tracking-widest">{{ uploading ? '處理中...' : (isEditing ? '更新數據資料' : '確認並儲存送出') }}</span>
                    </button>
                </form>
            </div>
        </div>

        <nav class="fixed bottom-0 inset-x-0 bg-white/90 backdrop-blur-xl border-t border-slate-100 p-3 flex justify-around z-40 shadow-[0_-8px_30px_rgba(0,0,0,0.05)]">
            <button v-for="(name, key) in tabNames" :key="key" @click="currentTab = key" :class="{'active': currentTab === key}" class="tab-btn flex flex-col items-center transition-all">
                <i class="fa-solid text-xl mb-1" :class="tabIcons[key]"></i>
                <span class="text-[10px] font-black tracking-tighter">{{name}}</span>
            </button>
        </nav>

        <button v-if="currentTab !== 'setting'" @click="openAddModal" class="btn-floating fixed right-6 bottom-24 bg-blue-600 text-white shadow-2xl shadow-blue-500/50 flex items-center justify-center z-40 active:scale-90 transition-all">
            <i class="fa-solid fa-plus text-xl"></i>
        </button>
    </div>

    <script src="script.js"></script>
</body>
</html>
